<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Refresh" content="10">
</head>
<body onload="main()">
<img id="birch" src="birch.png" alt="Birch" width="618" height="464"  style="display: none;"/>
<img id="butterfly" src="butterfly.png" alt="Butterfly" width="618" height="464"  style="display: none;"/>
<img id="frog" src="frog.png" alt="Frog" width="618" height="464"  style="display: none;"/>
<img id="leaf" src="leaf.png" alt="Leaf" width="618" height="464"  style="display: none;"/>
<img id="narcissus" src="narcissus.png" alt="Narcissus" width="618" height="464"  style="display: none;"/>
<img id="owl" src="owl.png" alt="Owl" width="618" height="464"  style="display: none;"/>
<img id="pine" src="pine.png" alt="Pine" width="618" height="464"  style="display: none;"/>
<img id="unicorn" src="unicorn.png" alt="Unicorn" width="618" height="464"  style="display: none;"/>

<script>
var dataStructure  = [['B','','','','','','','','','','','','T'],
                      ['','P','','','','','','','','','','',''],
                      ['','','B','','','','','','','','','',''],
                      ['','','','P','','','','','','','','',''],
                      ['','','','','B','','','','','','','',''],
                      ['','','','','','P','','','','','','',''],
                      ['','','','','','','B','','','','','',''],
                      ['','','','','','','','P','','','','',''],
                      ['','','','','','','','','B','','','',''],
                      ['','','','','','','','','','P','','',''],
                      ['O','','F','','','','','','','','B','','U']];
var serverURL = 'http://127.0.0.1/scale/';
var canvasWidth = 0;
var canvasHeight = 0;
var imageWidth = 100;
var imageHeight = 100;
var rowHeight = 0;
var columnWidth = 0;
var forestRows = 0;
var forestColumns = 0;
	
function main() {
	var size = {
		width: window.innerWidth || document.body.clientWidth,
		height: window.innerHeight || document.body.clientHeight
	}
	canvasWidth = size['width'] - 20;
	canvasHeight = size['height'] - 20;	

	var body = document.getElementsByTagName('body')[0];
	var canvas = document.createElement('canvas');
	canvas.setAttribute('id', 'forest');
	canvas.width = canvasWidth;
	canvas.height = canvasHeight;
	canvas.style.cssText = 'border:1px solid #d3d3d3;';
	body.appendChild(canvas);
	
    var context = canvas.getContext('2d');
	context.font = "30px Arial";
	context.fillText("Weight", 10, 50);
	
	forestRows = dataStructure.length;
	forestColumns = dataStructure[0].length;
	rowHeight = (canvasHeight / forestRows) - 40;
	columnWidth = canvasWidth / forestColumns;
	
	drawLines();
	updateForest();
}

function drawLines() {
	var canvas = document.getElementById('forest');
    var context = canvas.getContext('2d');
	
	horizonX = canvasWidth / 2;
	horizonY = canvasHeight / 2;    

	context.beginPath();
    context.rect(0, horizonY, canvasWidth, canvasHeight - horizonY);
    context.fillStyle = '#C1D311';
    context.fill();
	
	for (forestColumn = 0; forestColumn < forestColumns; forestColumn++) {
		var startX = horizonX + (forestColumn * columnWidth);
		drawLine(context, startX, canvasHeight, horizonX, horizonY);
		if (forestColumn != 0) {
			var startX = horizonX - (forestColumn * columnWidth);
			drawLine(context, startX, canvasHeight, horizonX, horizonY);
			forestColumn++
		}	
	}
}

function drawLine(context, fromX, fromY, toX, toY) {
	context.beginPath();
	context.moveTo(fromX, fromY);
	context.lineTo(toX, toY);
	context.strokeStyle = '#d3d3d3';
	context.stroke();
}

function drawTriangle(context, aX, aY, bX, bY, cX, cY) {
	context.beginPath();
	context.moveTo(aX, aY);
	context.lineTo(bX, bY);
	context.lineTo(cX, cY);
	context.closePath();
	context.strokeStyle = '#ff0000';

	context.stroke();
}

function canvasPosition(row, column) {
	var aX = columnWidth * column;
	var bY = canvasHeight;
	var cY = (rowHeight * row) + horizonY;
	
	var bigOpposite = canvasHeight - horizonY;
	var theta = Math.atan(bigOpposite / (horizonX - aX));
	var smallOpposite = bY - cY;
	var adjacentLength = smallOpposite / Math.tan(theta);
	x = adjacentLength + aX;
	y = cY;
	
	return [x, y];
}

function slope(fromX, fromY, toX, toY) {
	return (toY - fromY) / (toX - fromX);
}

function updateForest() {
	var trees = ['birch', 'pine'];
	var animals = ['butterfly', 'frog', 'owl', 'unicorn'];
	var canvasBorderPadding = 10;
	var gridWidth = (canvasWidth - (2 * canvasBorderPadding)) / forestColumns;
	var gridHeight = (canvasHeight - (2 * canvasBorderPadding)) / forestRows;
		
	var canvas = document.getElementById('forest');
    var context = canvas.getContext('2d');
	for (row = 0; row < forestRows; row++) {
		for (column = 0; column < forestColumns; column++) {
			var image = null;
			if (dataStructure[row][column] === 'B') {
				image = document.getElementById(trees[0]);
			} else if (dataStructure[row][column] === 'P') {
				image = document.getElementById(trees[1]);
			} else if (dataStructure[row][column] === 'T') {
				image = document.getElementById(animals[0]);
			} else if (dataStructure[row][column] === 'F') {
				image = document.getElementById(animals[1]);
			} else if (dataStructure[row][column] === 'O') {
				image = document.getElementById(animals[2]);
			} else if (dataStructure[row][column] === 'U') {
				image = document.getElementById(animals[3]);
			}
			
			if (image != null) {
				position = canvasPosition(row, column);
				var scaleFactor = (row + 1) / forestRows;
				var scaledWidth = imageWidth * scaleFactor;
				var scaledHeight = imageHeight * scaleFactor;
				var x = position[0] - (imageWidth / 2);
				var y = position[1] - imageHeight;
				context.drawImage(image, x, y, imageWidth, imageHeight);
			}
		}
	}
}

function initializeArray(rows, cols) {
	arr = new Array(rows);
	
	for (i = 0; i < rows; i++) {
		arr[i] = new Array(cols);
	}
	
	return arr;
}

</script>

</body>
</html>